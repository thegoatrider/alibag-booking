module.exports=[18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},50191,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(78560);function e({propertyId:a}){let[e,f]=(0,c.useState)(new Date),[g,h]=(0,c.useState)([]),[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)([]);(0,c.useEffect)(()=>{a&&o()},[a,e]);let o=async()=>{let b=new Date(e.getFullYear(),e.getMonth(),1),c=new Date(e.getFullYear(),e.getMonth()+1,0),f=[];for(let e=new Date(b);e<=c;e.setDate(e.getDate()+1)){let b=e.toISOString().split("T")[0],{data:c}=await d.supabase.from("bookings").select("id").eq("property_id",a).eq("status","confirmed").lte("check_in",b).gt("check_out",b),g=(c||[]).map(a=>a.id),h=0;if(g.length>0){let{count:a}=await d.supabase.from("booking_rooms").select("id",{count:"exact",head:!0}).in("booking_id",g);h=a||0}let{count:i}=await d.supabase.from("room_blocks").select("id",{count:"exact",head:!0}).eq("date",b);f.push({date:b,booked:h,blocked:i||0})}h(f)},p=async b=>{j(b);let{data:c}=await d.supabase.from("rooms").select("*").eq("property_id",a).eq("is_active",!0),{data:e}=await d.supabase.from("room_blocks").select("room_id").eq("date",b);l(c||[]),n((e||[]).map(a=>a.room_id))},q=async a=>{i&&(await d.supabase.from("room_blocks").insert({room_id:a,date:i}),p(i),o())},r=async()=>{if(!i)return;let{data:b}=await d.supabase.from("rooms").select("id").eq("property_id",a).eq("is_active",!0);if(!b||0===b.length)return;let{data:c}=await d.supabase.from("room_blocks").select("room_id").eq("date",i),e=new Set((c||[]).map(a=>a.room_id)),f=b.filter(a=>!e.has(a.id)).map(a=>({room_id:a.id,date:i}));f.length>0&&await d.supabase.from("room_blocks").insert(f),p(i),o()};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,b.jsx)("button",{onClick:()=>f(new Date(e.getFullYear(),e.getMonth()-1)),children:"â†"}),(0,b.jsxs)("h2",{className:"font-semibold",children:[e.toLocaleString("default",{month:"long"})," ",e.getFullYear()]}),(0,b.jsx)("button",{onClick:()=>f(new Date(e.getFullYear(),e.getMonth()+1)),children:"â†’"})]}),(0,b.jsx)("div",{className:"grid grid-cols-7 gap-2",children:g.map(a=>(0,b.jsxs)("div",{onClick:()=>p(a.date),className:"border rounded p-2 cursor-pointer hover:bg-gray-50",children:[(0,b.jsx)("div",{className:"font-medium",children:new Date(a.date).getDate()}),(0,b.jsxs)("div",{className:"text-xs text-gray-700",children:[a.booked," booked"]}),(0,b.jsxs)("div",{className:"text-xs text-red-700",children:[a.blocked," blocked"]})]},a.date))}),i&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:(0,b.jsxs)("div",{className:"bg-white text-black rounded-lg p-6 w-full max-w-lg space-y-4",children:[(0,b.jsx)("h3",{className:"font-semibold text-lg",children:i}),(0,b.jsx)("button",{onClick:r,className:"bg-black text-white px-4 py-2 rounded",children:"Block Entire Property"}),(0,b.jsx)("div",{className:"space-y-2",children:k.map(a=>(0,b.jsxs)("div",{className:"flex justify-between items-center border p-2 rounded",children:[(0,b.jsxs)("div",{children:[a.name," â€“ â‚¹",a.price]}),m.includes(a.id)?(0,b.jsx)("span",{className:"text-red-600 text-sm",children:"Blocked"}):(0,b.jsx)("button",{onClick:()=>q(a.id),className:"text-sm underline",children:"Block"})]},a.id))}),(0,b.jsx)("button",{onClick:()=>j(null),className:"text-sm underline w-full text-center",children:"Close"})]})})]})}function f({ownerId:a}){let[e,f]=(0,c.useState)({total:0,enquired:0,viewed:0,shortlisted:0,booked:0,dropped:0});(0,c.useEffect)(()=>{a&&g()},[a]);let g=async()=>{let{data:b}=await d.supabase.from("leads").select("status").eq("owner_id",a),c={total:b?.length||0,enquired:0,viewed:0,shortlisted:0,booked:0,dropped:0};b?.forEach(a=>{let b=a.status;void 0!==c[b]&&c[b]++}),f(c)},h=e.enquired>0?Math.round(e.booked/e.enquired*100):0,i=({label:a,value:c,color:d})=>(0,b.jsxs)("div",{className:"bg-neutral-900 border border-neutral-700 rounded p-4",children:[(0,b.jsx)("div",{className:"text-sm text-gray-400",children:a}),(0,b.jsx)("div",{className:`text-2xl font-bold ${d}`,children:c})]});return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold",children:"Lead Funnel"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[(0,b.jsx)(i,{label:"Enquired",value:e.enquired,color:"text-blue-400"}),(0,b.jsx)(i,{label:"Viewed",value:e.viewed,color:"text-yellow-400"}),(0,b.jsx)(i,{label:"Shortlisted",value:e.shortlisted,color:"text-purple-400"}),(0,b.jsx)(i,{label:"Booked",value:e.booked,color:"text-green-400"}),(0,b.jsx)(i,{label:"Dropped",value:e.dropped,color:"text-red-400"}),(0,b.jsx)(i,{label:"Conversion %",value:h,color:"text-indigo-400"})]})]})}function g(){let[a,g]=(0,c.useState)("leads"),[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(""),[l,m]=(0,c.useState)([]),[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)([]),[r,s]=(0,c.useState)(""),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)(""),[x,y]=(0,c.useState)([]),[z,A]=(0,c.useState)(""),[B,C]=(0,c.useState)("");(0,c.useEffect)(()=>{D()},[]),(0,c.useEffect)(()=>{j&&(E(j),F(j))},[j]),(0,c.useEffect)(()=>{n&&G(n)},[n]);let D=async()=>{let{data:a}=await d.supabase.from("owners").select("*");i(a||[])},E=async a=>{let{data:b}=await d.supabase.from("properties").select("*").eq("owner_id",a);m(b||[]),o("")},F=async a=>{let{data:b}=await d.supabase.from("leads").select("*").eq("owner_id",a).order("created_at",{ascending:!1});q(b||[])},G=async a=>{let{data:b}=await d.supabase.from("rooms").select("*").eq("property_id",a).order("created_at");y(b||[])},H=async()=>{if(!r||!t||!v||!n)return void alert("Fill all fields");let{data:a,error:b}=await d.supabase.from("leads").insert({owner_id:j,property_id:n,phone:r,check_in:t,check_out:v,status:"enquired",source:"owner"}).select().single();if(b||!a)return void alert("Lead insert failed");let c=l.find(a=>a.id===n);if(!c)return;let e=`${window.location.origin}/p/${c.slug}?ci=${t}&co=${v}&lead=${a.id}`,f=`Thank you for contacting ${c.name} ðŸŒ´

Dates: ${t} to ${v}

View availability & book:
${e}`;window.open(`https://wa.me/91${r}?text=${encodeURIComponent(f)}`,"_blank"),s(""),u(""),w(""),o(""),F(j)},I=async()=>{z&&B&&n&&(await d.supabase.from("rooms").insert({property_id:n,name:z,price:Number(B),is_active:!0}),A(""),C(""),G(n))},J=async(a,b)=>{await d.supabase.from("rooms").update({is_active:!b}).eq("id",a),G(n)};return(0,b.jsxs)("main",{className:"p-10 max-w-6xl space-y-6 bg-black min-h-screen text-white",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold",children:"Owner Dashboard"}),(0,b.jsx)("div",{className:"flex gap-4",children:["leads","properties"].map(c=>(0,b.jsx)("button",{onClick:()=>g(c),className:`px-4 py-2 rounded ${a===c?"bg-indigo-600 text-white":"bg-neutral-800 border border-neutral-700 text-gray-300"}`,children:c.charAt(0).toUpperCase()+c.slice(1)},c))}),(0,b.jsxs)("select",{className:"bg-neutral-800 border border-neutral-600 p-2 w-full text-white",value:j,onChange:a=>k(a.target.value),children:[(0,b.jsx)("option",{value:"",children:"Select Owner"}),h.map(a=>(0,b.jsx)("option",{value:a.id,children:a.email},a.id))]}),"leads"===a&&j&&(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(f,{ownerId:j}),(0,b.jsxs)("div",{className:"bg-neutral-900 border border-neutral-700 rounded p-6 space-y-3",children:[(0,b.jsx)("h2",{className:"font-semibold text-lg border-b border-neutral-700 pb-2",children:"New Enquiry"}),(0,b.jsxs)("select",{className:"bg-neutral-800 border border-neutral-600 p-2 w-full",value:n,onChange:a=>o(a.target.value),children:[(0,b.jsx)("option",{value:"",children:"Select Property"}),l.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]}),(0,b.jsx)("input",{className:"bg-neutral-800 border border-neutral-600 p-2 w-full",placeholder:"Phone",value:r,onChange:a=>s(a.target.value)}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("input",{type:"date",className:"bg-neutral-800 border border-neutral-600 p-2 flex-1",value:t,onChange:a=>u(a.target.value)}),(0,b.jsx)("input",{type:"date",className:"bg-neutral-800 border border-neutral-600 p-2 flex-1",value:v,onChange:a=>w(a.target.value)})]}),(0,b.jsx)("button",{onClick:H,className:"bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded",children:"Send Property Link"})]}),(0,b.jsx)("div",{className:"bg-neutral-900 border border-neutral-700 rounded p-4",children:(0,b.jsxs)("table",{className:"w-full text-left",children:[(0,b.jsx)("thead",{className:"text-gray-400",children:(0,b.jsxs)("tr",{className:"border-b border-neutral-700",children:[(0,b.jsx)("th",{className:"py-2",children:"Phone"}),(0,b.jsx)("th",{children:"Status"}),(0,b.jsx)("th",{children:"Dates"})]})}),(0,b.jsxs)("tbody",{children:[p.map(a=>(0,b.jsxs)("tr",{className:"border-b border-neutral-800",children:[(0,b.jsx)("td",{className:"py-2",children:a.phone}),(0,b.jsx)("td",{children:(0,b.jsx)("span",{className:`px-3 py-1 rounded text-xs ${{enquired:"bg-blue-600",viewed:"bg-yellow-500 text-black",shortlisted:"bg-purple-600",booked:"bg-green-600",dropped:"bg-red-600"}[a.status]||"bg-gray-600"}`,children:a.status})}),(0,b.jsxs)("td",{children:[a.check_in," â†’ ",a.check_out]})]},a.id)),0===p.length&&(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:3,className:"py-4 text-gray-500",children:"No leads yet"})})]})]})})]}),"properties"===a&&j&&(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("select",{className:"bg-neutral-800 border border-neutral-600 p-2 w-full",value:n,onChange:a=>o(a.target.value),children:[(0,b.jsx)("option",{value:"",children:"Select Property"}),l.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]}),n&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"bg-neutral-900 border border-neutral-700 rounded p-6",children:(0,b.jsx)(e,{propertyId:n})}),(0,b.jsxs)("div",{className:"bg-neutral-900 border border-neutral-700 rounded p-6 space-y-3",children:[(0,b.jsx)("h2",{className:"font-semibold text-lg border-b border-neutral-700 pb-2",children:"Rooms"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("input",{className:"bg-neutral-800 border border-neutral-600 p-2 flex-1",placeholder:"Room name",value:z,onChange:a=>A(a.target.value)}),(0,b.jsx)("input",{className:"bg-neutral-800 border border-neutral-600 p-2 w-32",placeholder:"Price",value:B,onChange:a=>C(a.target.value)}),(0,b.jsx)("button",{onClick:I,className:"bg-indigo-600 hover:bg-indigo-700 px-4",children:"Add"})]}),x.map(a=>(0,b.jsxs)("div",{className:"flex justify-between items-center border border-neutral-700 p-2 rounded",children:[(0,b.jsxs)("div",{children:[a.name," â€” â‚¹",a.price]}),(0,b.jsx)("button",{onClick:()=>J(a.id,a.is_active),className:`px-3 py-1 rounded ${a.is_active?"bg-green-600":"bg-neutral-600"}`,children:a.is_active?"Active":"Inactive"})]},a.id))]})]})]})]})}a.s(["default",()=>g],50191)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__f5366249._.js.map