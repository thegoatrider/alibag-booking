(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,72552,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(17927);function r({propertyId:e}){let[r,l]=(0,a.useState)(new Date),[d,n]=(0,a.useState)([]),[o,i]=(0,a.useState)(null),[c,u]=(0,a.useState)([]),[b,p]=(0,a.useState)([]);(0,a.useEffect)(()=>{e&&x()},[e,r]);let x=async()=>{let t=new Date(r.getFullYear(),r.getMonth(),1),a=new Date(r.getFullYear(),r.getMonth()+1,0),l=[];for(let r=new Date(t);r<=a;r.setDate(r.getDate()+1)){let t=r.toISOString().split("T")[0],{data:a}=await s.supabase.from("bookings").select("id").eq("property_id",e).eq("status","confirmed").lte("check_in",t).gt("check_out",t),d=(a||[]).map(e=>e.id),n=0;if(d.length>0){let{count:e}=await s.supabase.from("booking_rooms").select("id",{count:"exact",head:!0}).in("booking_id",d);n=e||0}let{count:o}=await s.supabase.from("room_blocks").select("id",{count:"exact",head:!0}).eq("date",t);l.push({date:t,booked:n,blocked:o||0})}n(l)},m=async t=>{i(t);let{data:a}=await s.supabase.from("rooms").select("*").eq("property_id",e).eq("is_active",!0),{data:r}=await s.supabase.from("room_blocks").select("room_id").eq("date",t);u(a||[]),p((r||[]).map(e=>e.room_id))},h=async e=>{o&&(await s.supabase.from("room_blocks").insert({room_id:e,date:o}),m(o),x())},g=async()=>{if(!o)return;let{data:t}=await s.supabase.from("rooms").select("id").eq("property_id",e).eq("is_active",!0);if(!t||0===t.length)return;let{data:a}=await s.supabase.from("room_blocks").select("room_id").eq("date",o),r=new Set((a||[]).map(e=>e.room_id)),l=t.filter(e=>!r.has(e.id)).map(e=>({room_id:e.id,date:o}));l.length>0&&await s.supabase.from("room_blocks").insert(l),m(o),x()};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("button",{onClick:()=>l(new Date(r.getFullYear(),r.getMonth()-1)),children:"â†"}),(0,t.jsxs)("h2",{className:"font-semibold",children:[r.toLocaleString("default",{month:"long"})," ",r.getFullYear()]}),(0,t.jsx)("button",{onClick:()=>l(new Date(r.getFullYear(),r.getMonth()+1)),children:"â†’"})]}),(0,t.jsx)("div",{className:"grid grid-cols-7 gap-2",children:d.map(e=>(0,t.jsxs)("div",{onClick:()=>m(e.date),className:"border rounded p-2 cursor-pointer hover:bg-gray-50",children:[(0,t.jsx)("div",{className:"font-medium",children:new Date(e.date).getDate()}),(0,t.jsxs)("div",{className:"text-xs text-gray-700",children:[e.booked," booked"]}),(0,t.jsxs)("div",{className:"text-xs text-red-700",children:[e.blocked," blocked"]})]},e.date))}),o&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white text-black rounded-lg p-6 w-full max-w-lg space-y-4",children:[(0,t.jsx)("h3",{className:"font-semibold text-lg",children:o}),(0,t.jsx)("button",{onClick:g,className:"bg-black text-white px-4 py-2 rounded",children:"Block Entire Property"}),(0,t.jsx)("div",{className:"space-y-2",children:c.map(e=>(0,t.jsxs)("div",{className:"flex justify-between items-center border p-2 rounded",children:[(0,t.jsxs)("div",{children:[e.name," â€“ â‚¹",e.price]}),b.includes(e.id)?(0,t.jsx)("span",{className:"text-red-600 text-sm",children:"Blocked"}):(0,t.jsx)("button",{onClick:()=>h(e.id),className:"text-sm underline",children:"Block"})]},e.id))}),(0,t.jsx)("button",{onClick:()=>i(null),className:"text-sm underline w-full text-center",children:"Close"})]})})]})}function l({ownerId:e}){let[r,l]=(0,a.useState)({total:0,enquired:0,viewed:0,shortlisted:0,booked:0,dropped:0});(0,a.useEffect)(()=>{e&&d()},[e]);let d=async()=>{let{data:t}=await s.supabase.from("leads").select("status").eq("owner_id",e),a={total:t?.length||0,enquired:0,viewed:0,shortlisted:0,booked:0,dropped:0};t?.forEach(e=>{let t=e.status;void 0!==a[t]&&a[t]++}),l(a)},n=r.enquired>0?Math.round(r.booked/r.enquired*100):0,o=({label:e,value:a,color:s})=>(0,t.jsxs)("div",{className:"bg-neutral-900 border border-neutral-700 rounded p-4",children:[(0,t.jsx)("div",{className:"text-sm text-gray-400",children:e}),(0,t.jsx)("div",{className:`text-2xl font-bold ${s}`,children:a})]});return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold",children:"Lead Funnel"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[(0,t.jsx)(o,{label:"Enquired",value:r.enquired,color:"text-blue-400"}),(0,t.jsx)(o,{label:"Viewed",value:r.viewed,color:"text-yellow-400"}),(0,t.jsx)(o,{label:"Shortlisted",value:r.shortlisted,color:"text-purple-400"}),(0,t.jsx)(o,{label:"Booked",value:r.booked,color:"text-green-400"}),(0,t.jsx)(o,{label:"Dropped",value:r.dropped,color:"text-red-400"}),(0,t.jsx)(o,{label:"Conversion %",value:n,color:"text-indigo-400"})]})]})}function d(){let[e,d]=(0,a.useState)("leads"),[n,o]=(0,a.useState)([]),[i,c]=(0,a.useState)(""),[u,b]=(0,a.useState)([]),[p,x]=(0,a.useState)(""),[m,h]=(0,a.useState)([]),[g,j]=(0,a.useState)(""),[f,v]=(0,a.useState)(""),[w,y]=(0,a.useState)(""),[N,k]=(0,a.useState)([]),[_,S]=(0,a.useState)(""),[C,q]=(0,a.useState)("");(0,a.useEffect)(()=>{$()},[]),(0,a.useEffect)(()=>{i&&(D(i),E(i))},[i]),(0,a.useEffect)(()=>{p&&F(p)},[p]);let $=async()=>{let{data:e}=await s.supabase.from("owners").select("*");o(e||[])},D=async e=>{let{data:t}=await s.supabase.from("properties").select("*").eq("owner_id",e);b(t||[]),x("")},E=async e=>{let{data:t}=await s.supabase.from("leads").select("*").eq("owner_id",e).order("created_at",{ascending:!1});h(t||[])},F=async e=>{let{data:t}=await s.supabase.from("rooms").select("*").eq("property_id",e).order("created_at");k(t||[])},P=async()=>{if(!g||!f||!w||!p)return void alert("Fill all fields");let{data:e,error:t}=await s.supabase.from("leads").insert({owner_id:i,property_id:p,phone:g,check_in:f,check_out:w,status:"enquired",source:"owner"}).select().single();if(t||!e)return void alert("Lead insert failed");let a=u.find(e=>e.id===p);if(!a)return;let r=`${window.location.origin}/p/${a.slug}?ci=${f}&co=${w}&lead=${e.id}`,l=`Thank you for contacting ${a.name} ðŸŒ´

Dates: ${f} to ${w}

View availability & book:
${r}`;window.open(`https://wa.me/91${g}?text=${encodeURIComponent(l)}`,"_blank"),j(""),v(""),y(""),x(""),E(i)},B=async()=>{_&&C&&p&&(await s.supabase.from("rooms").insert({property_id:p,name:_,price:Number(C),is_active:!0}),S(""),q(""),F(p))},T=async(e,t)=>{await s.supabase.from("rooms").update({is_active:!t}).eq("id",e),F(p)};return(0,t.jsxs)("main",{className:"p-10 max-w-6xl space-y-6 bg-black min-h-screen text-white",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Owner Dashboard"}),(0,t.jsx)("div",{className:"flex gap-4",children:["leads","properties"].map(a=>(0,t.jsx)("button",{onClick:()=>d(a),className:`px-4 py-2 rounded ${e===a?"bg-indigo-600 text-white":"bg-neutral-800 border border-neutral-700 text-gray-300"}`,children:a.charAt(0).toUpperCase()+a.slice(1)},a))}),(0,t.jsxs)("select",{className:"bg-neutral-800 border border-neutral-600 p-2 w-full text-white",value:i,onChange:e=>c(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Select Owner"}),n.map(e=>(0,t.jsx)("option",{value:e.id,children:e.email},e.id))]}),"leads"===e&&i&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(l,{ownerId:i}),(0,t.jsxs)("div",{className:"bg-neutral-900 border border-neutral-700 rounded p-6 space-y-3",children:[(0,t.jsx)("h2",{className:"font-semibold text-lg border-b border-neutral-700 pb-2",children:"New Enquiry"}),(0,t.jsxs)("select",{className:"bg-neutral-800 border border-neutral-600 p-2 w-full",value:p,onChange:e=>x(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Select Property"}),u.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,t.jsx)("input",{className:"bg-neutral-800 border border-neutral-600 p-2 w-full",placeholder:"Phone",value:g,onChange:e=>j(e.target.value)}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{type:"date",className:"bg-neutral-800 border border-neutral-600 p-2 flex-1",value:f,onChange:e=>v(e.target.value)}),(0,t.jsx)("input",{type:"date",className:"bg-neutral-800 border border-neutral-600 p-2 flex-1",value:w,onChange:e=>y(e.target.value)})]}),(0,t.jsx)("button",{onClick:P,className:"bg-indigo-600 hover:bg-indigo-700 px-4 py-2 rounded",children:"Send Property Link"})]}),(0,t.jsx)("div",{className:"bg-neutral-900 border border-neutral-700 rounded p-4",children:(0,t.jsxs)("table",{className:"w-full text-left",children:[(0,t.jsx)("thead",{className:"text-gray-400",children:(0,t.jsxs)("tr",{className:"border-b border-neutral-700",children:[(0,t.jsx)("th",{className:"py-2",children:"Phone"}),(0,t.jsx)("th",{children:"Status"}),(0,t.jsx)("th",{children:"Dates"})]})}),(0,t.jsxs)("tbody",{children:[m.map(e=>(0,t.jsxs)("tr",{className:"border-b border-neutral-800",children:[(0,t.jsx)("td",{className:"py-2",children:e.phone}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:`px-3 py-1 rounded text-xs ${{enquired:"bg-blue-600",viewed:"bg-yellow-500 text-black",shortlisted:"bg-purple-600",booked:"bg-green-600",dropped:"bg-red-600"}[e.status]||"bg-gray-600"}`,children:e.status})}),(0,t.jsxs)("td",{children:[e.check_in," â†’ ",e.check_out]})]},e.id)),0===m.length&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:3,className:"py-4 text-gray-500",children:"No leads yet"})})]})]})})]}),"properties"===e&&i&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("select",{className:"bg-neutral-800 border border-neutral-600 p-2 w-full",value:p,onChange:e=>x(e.target.value),children:[(0,t.jsx)("option",{value:"",children:"Select Property"}),u.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]}),p&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"bg-neutral-900 border border-neutral-700 rounded p-6",children:(0,t.jsx)(r,{propertyId:p})}),(0,t.jsxs)("div",{className:"bg-neutral-900 border border-neutral-700 rounded p-6 space-y-3",children:[(0,t.jsx)("h2",{className:"font-semibold text-lg border-b border-neutral-700 pb-2",children:"Rooms"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{className:"bg-neutral-800 border border-neutral-600 p-2 flex-1",placeholder:"Room name",value:_,onChange:e=>S(e.target.value)}),(0,t.jsx)("input",{className:"bg-neutral-800 border border-neutral-600 p-2 w-32",placeholder:"Price",value:C,onChange:e=>q(e.target.value)}),(0,t.jsx)("button",{onClick:B,className:"bg-indigo-600 hover:bg-indigo-700 px-4",children:"Add"})]}),N.map(e=>(0,t.jsxs)("div",{className:"flex justify-between items-center border border-neutral-700 p-2 rounded",children:[(0,t.jsxs)("div",{children:[e.name," â€” â‚¹",e.price]}),(0,t.jsx)("button",{onClick:()=>T(e.id,e.is_active),className:`px-3 py-1 rounded ${e.is_active?"bg-green-600":"bg-neutral-600"}`,children:e.is_active?"Active":"Inactive"})]},e.id))]})]})]})]})}e.s(["default",()=>d],72552)}]);